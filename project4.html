<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced To-Do List with Interactive Calendar</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      padding: 30px;
      margin: 0;
      perspective: 1000px;
      overflow: hidden;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      position: relative;
    }

    /* Snowflake layer */
    .snowflake {
      position: absolute;
      top: -10px;
      color: #ddd;
      font-size: 1em;
      user-select: none;
      pointer-events: none;
      animation-name: fall;
      animation-timing-function: linear;
      opacity: 0.8;
    }

    @keyframes fall {
      0% { transform: translateY(0px) rotate(0deg); opacity: 0.8; }
      100% { transform: translateY(110vh) rotate(360deg); opacity: 0.3; }
    }

    /* To-Do List */
    .todo-container {
      background: rgba(20, 20, 30, 0.85);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 20px;
      width: 500px;
      box-shadow: 0px 12px 30px rgba(0,0,0,0.7);
      transform: translateZ(0);
    }
    h1 { text-align: center; margin-bottom: 15px; }

    /* Progress Tracker */
    .progress { margin: 10px 0 20px; }
    .progress-bar {
      width: 100%; background: rgba(255,255,255,0.1);
      border-radius: 10px; overflow: hidden; height: 18px;
    }
    .progress-fill { height: 100%; width: 0%; background: #1abc9c; transition: width 0.4s; }
    .progress-text { text-align: right; font-size: 13px; margin-top: 5px; opacity: 0.9; }

    /* Inputs */
    .input-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px; }
    input, select {
      padding: 10px; border: none; border-radius: 12px;
      outline: none; font-size: 14px;
      background: rgba(255,255,255,0.1);
      color: #fff;
    }
    button {
      padding: 10px; border: none; background: #1abc9c; color: white;
      font-weight: bold; border-radius: 12px; cursor: pointer; transition: 0.3s;
    }
    button:hover { background: #16a085; }

    /* Filters */
    .filters { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
    .filters select, .filters input { flex: 1; }

    /* Task List */
    ul { list-style: none; padding: 0; margin: 0; max-height: 350px; overflow-y: auto; }
    li {
      background: rgba(50,50,70,0.5); padding: 12px; border-radius: 12px;
      display: flex; flex-direction: column; margin-bottom: 10px; transition: 0.3s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    li.completed span.task-text { text-decoration: line-through; opacity: 0.6; }
    li.overdue { border: 2px solid #e74c3c; background: rgba(200,0,0,0.3); }

    .task-header { display: flex; justify-content: space-between; align-items: center; }
    .category {
      padding: 3px 8px; border-radius: 8px; font-size: 12px; font-weight: bold;
    }
    .work { background: #3498db; } .personal { background: #9b59b6; } .urgent { background: #e74c3c; }

    .actions { margin-top: 8px; }
    .actions button {
      margin-right: 5px; border-radius: 8px; padding: 5px 8px; font-size: 12px;
    }
    .edit-btn { background: #f39c12; }
    .delete-btn { background: #e74c3c; }
    .complete-btn { background: #2ecc71; }

    .due-date { font-size: 12px; margin-top: 5px; opacity: 0.9; }
    .due-date.overdue { color: #e74c3c; font-weight: bold; }

    /* Calendar */
    .calendar-container {
      background: rgba(20, 20, 30, 0.85); padding: 20px; border-radius: 20px;
      width: 320px; box-shadow: 0px 12px 30px rgba(0,0,0,0.7); transform: translateZ(0);
      position: relative;
    }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; }
    .calendar-header button {
      padding: 6px 10px; font-size: 14px; border-radius: 8px; background: #1abc9c;
    }
    .calendar-header button:hover { background: #16a085; }
    .calendar-header span { font-size: 16px; font-weight: bold; }
    .calendar {
      display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 15px;
    }
    .calendar div {
      padding: 8px; text-align: center; border-radius: 8px;
      background: rgba(255,255,255,0.1); cursor: pointer; position: relative;
    }
    .calendar div:hover { background: rgba(255,255,255,0.3); }
    .calendar .today { background: #1abc9c; font-weight: bold; }
    .calendar .has-task { background: #f39c12; color: #000; font-weight: bold; }
    .reset-btn { margin-top: 10px; width: 100%; background: #1abc9c; }

    /* Tooltip */
    .tooltip {
      position: absolute; background: rgba(0,0,0,0.9);
      color: #fff; padding: 8px; border-radius: 8px;
      font-size: 12px; min-width: 200px; display: none;
      z-index: 20; pointer-events: auto;
    }
    .tooltip .task-preview {
      padding: 6px; margin-bottom: 5px;
      background: rgba(50,50,70,0.5); border-radius: 6px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .tooltip .task-preview:last-child { margin-bottom: 0; }
    .tooltip button {
      padding: 2px 5px; font-size: 11px;
      border-radius: 4px; margin-left: 3px; cursor: pointer;
    }
    .tooltip .done { background: #2ecc71; }
    .tooltip .edit { background: #f39c12; }
    .tooltip .delete { background: #e74c3c; }

  </style>
</head>
<body>
  <!-- Snowflake container -->
  <div id="snowflakes"></div>

  <!-- To-Do List -->
  <div class="todo-container">
    <h1>📌 To-Do List</h1>
    <div class="progress">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="progress-text" id="progressText">0% completed</div>
    </div>
    <div class="input-group">
      <input type="text" id="taskInput" placeholder="Enter new task...">
      <select id="categoryInput">
        <option value="work">Work</option>
        <option value="personal">Personal</option>
        <option value="urgent">Urgent</option>
      </select>
      <input type="date" id="dateInput">
      <button onclick="addTask()">Add Task</button>
    </div>
    <div class="filters">
      <select id="filterInput" onchange="renderTasks()">
        <option value="all">All</option>
        <option value="completed">Completed</option>
        <option value="pending">Pending</option>
        <option value="urgent">Urgent</option>
      </select>
      <select id="sortInput" onchange="renderTasks()">
        <option value="default">Sort: Default</option>
        <option value="date">Sort: Due Date</option>
        <option value="category">Sort: Category</option>
      </select>
    </div>
    <div class="filters"><input type="text" id="searchInput" placeholder="🔍 Search tasks..." oninput="renderTasks()"></div>
    <ul id="taskList"></ul>
  </div>

  <!-- Calendar -->
  <div class="calendar-container">
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">◀</button>
      <span id="monthYear"></span>
      <button onclick="changeMonth(1)">▶</button>
    </div>
    <div id="calendar" class="calendar"></div>
    <button class="reset-btn" onclick="resetCalendar()">🔄 Show All Tasks</button>
    <div id="tooltip" class="tooltip"></div>
  </div>

  <script>
    // Snowflake effect
    const snowContainer = document.getElementById("snowflakes");
    const snowCount = 60;
    for (let i = 0; i < snowCount; i++) {
      const snow = document.createElement("div");
      snow.classList.add("snowflake");
      snow.style.left = Math.random() * 100 + "vw";
      snow.style.fontSize = (Math.random()*12+12)+"px";
      snow.style.animationDuration = (Math.random()*12+8)+"s";
      snow.style.animationDelay = Math.random()*10+"s";
      snow.textContent = "❄";
      snowContainer.appendChild(snow);
    }

    // Existing To-Do & Calendar scripts (unchanged)
    let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
    let selectedDate = null; 
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    function saveTasks() { localStorage.setItem("tasks", JSON.stringify(tasks)); }

    function updateProgress() {
      let total = tasks.length;
      let completed = tasks.filter(t => t.completed).length;
      let percent = total === 0 ? 0 : Math.round((completed / total) * 100);
      document.getElementById("progressFill").style.width = percent + "%";
      document.getElementById("progressText").textContent = `${percent}% completed`;
    }

    function renderTasks() {
      const taskList = document.getElementById("taskList");
      const filter = document.getElementById("filterInput").value;
      const sort = document.getElementById("sortInput").value;
      const search = document.getElementById("searchInput").value.toLowerCase();

      let filteredTasks = [...tasks];
      if (selectedDate) filteredTasks = filteredTasks.filter(t => t.date === selectedDate);
      if (filter === "completed") filteredTasks = filteredTasks.filter(t => t.completed);
      else if (filter === "pending") filteredTasks = filteredTasks.filter(t => !t.completed);
      else if (filter === "urgent") filteredTasks = filteredTasks.filter(t => t.category === "urgent");
      if (search) filteredTasks = filteredTasks.filter(t => t.text.toLowerCase().includes(search));
      if (sort === "date") filteredTasks.sort((a,b)=> (a.date||"").localeCompare(b.date||""));
      else if (sort === "category") filteredTasks.sort((a,b)=>a.category.localeCompare(b.category));

      taskList.innerHTML = "";
      const today = new Date().toISOString().split("T")[0];
      filteredTasks.forEach((task, index) => {
        let li = document.createElement("li");
        li.className = task.completed ? "completed" : "";
        if (task.date && task.date < today && !task.completed) li.classList.add("overdue");
        li.innerHTML = `
          <div class="task-header">
            <span class="task-text">${task.text}</span>
            <span class="category ${task.category}">${task.category}</span>
          </div>
          <div class="due-date">${task.date || "No deadline"}</div>
          <div class="actions">
            <button class="complete-btn" onclick="toggleComplete(${index})">✔</button>
            <button class="edit-btn" onclick="editTask(${index})">✏</button>
            <button class="delete-btn" onclick="deleteTask(${index})">🗑</button>
          </div>`;
        taskList.appendChild(li);
      });

      updateProgress();
      renderCalendar();
    }

    function addTask() {
      const taskInput = document.getElementById("taskInput");
      const categoryInput = document.getElementById("categoryInput");
      const dateInput = document.getElementById("dateInput");
      if (taskInput.value.trim() === "") return;
      tasks.push({ text: taskInput.value, category: categoryInput.value, date: dateInput.value, completed: false });
      taskInput.value = ""; dateInput.value = ""; saveTasks(); renderTasks();
    }
    function deleteTask(index) { tasks.splice(index, 1); saveTasks(); renderTasks(); }
    function editTask(index) { let t=prompt("Edit task:",tasks[index].text); if(t){tasks[index].text=t; saveTasks(); renderTasks();} }
    function toggleComplete(index) { tasks[index].completed=!tasks[index].completed; saveTasks(); renderTasks(); }

    function renderCalendar() {
      const calendar=document.getElementById("calendar");
      const monthYear=document.getElementById("monthYear");
      const tooltip=document.getElementById("tooltip");
      calendar.innerHTML="";
      const today=new Date(); const thisMonth=today.getMonth(); const thisYear=today.getFullYear(); const thisDate=today.getDate();
      const firstDay=new Date(currentYear,currentMonth,1).getDay();
      const daysInMonth=new Date(currentYear,currentMonth+1,0).getDate();
      monthYear.textContent=`${new Date(currentYear,currentMonth).toLocaleString("default",{month:"long"})} ${currentYear}`;
      ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d=>{let div=document.createElement("div");div.textContent=d;div.style.fontWeight="bold";calendar.appendChild(div);});
      for(let i=0;i<firstDay;i++){calendar.appendChild(document.createElement("div"));}
      for(let day=1;day<=daysInMonth;day++){
        let div=document.createElement("div"); div.textContent=day;
        let dateStr=`${currentYear}-${String(currentMonth+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
        if(day===thisDate && currentMonth===thisMonth && currentYear===thisYear) div.classList.add("today");
        let dayTasks=tasks.map((t,i)=>({...t,index:i})).filter(t=>t.date===dateStr);
        if(dayTasks.length>0){
          div.classList.add("has-task");
          div.onmouseenter=(e)=>{
            tooltip.innerHTML=dayTasks.map(t=>
              `<div class="task-preview">
                <span>${t.text}</span>
                <div>
                  <button class="done" onclick="toggleComplete(${t.index});event.stopPropagation();">✔</button>
                  <button class="edit" onclick="editTask(${t.index});event.stopPropagation();">✏</button>
                  <button class="delete" onclick="deleteTask(${t.index});event.stopPropagation();">🗑</button>
                </div>
              </div>`).join("");
            tooltip.style.display="block";
            tooltip.style.left=e.pageX+10+"px";
            tooltip.style.top=e.pageY+10+"px";
          };
          div.onmousemove=(e)=>{tooltip.style.left=e.pageX+10+"px"; tooltip.style.top=e.pageY+10+"px";};
          div.onmouseleave=()=>{tooltip.style.display="none";};
        }
        div.onclick=()=>{selectedDate=dateStr; renderTasks();};
        calendar.appendChild(div);
      }
    }

    function resetCalendar(){selectedDate=null; renderTasks();}
    function changeMonth(offset){currentMonth+=offset;if(currentMonth<0){currentMonth=11;currentYear--;}else if(currentMonth>11){currentMonth=0;currentYear++;}renderCalendar();}
    renderTasks();
  </script>
</body>
</html>
